<!--compress.wxml-->
<view class="container">
  <!-- 顶部导航 -->
  <view class="header">
    <text class="title">图片压缩</text>
    <text class="subtitle">减小图片文件大小，保持清晰度</text>
  </view>

  <!-- 图片选择区域 -->
  <view class="upload-section">
    <view class="upload-area" bindtap="chooseImage" wx:if="{{!imageSrc}}">
      <view class="upload-icon">📷</view>
      <text class="upload-text">点击选择图片</text>
      <text class="upload-desc">支持JPG、PNG格式</text>
    </view>
    
    <view class="image-preview" wx:else>
      <image src="{{imageSrc}}" mode="aspectFit" class="preview-image"></image>
      <view class="image-info">
        <text class="info-item">原始大小: {{originalSize}}</text>
        <text class="info-item">原始尺寸: {{originalDimensions}}</text>
      </view>
      <button class="change-btn" bindtap="chooseImage">重新选择</button>
    </view>
  </view>

  <!-- 压缩设置 -->
  <view class="settings-section" wx:if="{{imageSrc}}">
    <view class="setting-item">
      <text class="setting-label">压缩质量</text>
      <slider 
        class="quality-slider" 
        min="10" 
        max="100" 
        value="{{quality}}" 
        bindchange="onQualityChange"
        activeColor="#667eea"
        backgroundColor="#e0e0e0"
        block-size="20"
      />
      <text class="quality-value">{{quality}}%</text>
    </view>

    <view class="setting-item">
      <text class="setting-label">目标大小</text>
      <text class="setting-desc">优先保持图片内容，仅在必要时调整尺寸</text>
      <view class="size-options">
        <button 
          class="size-btn {{targetSize === 'auto' ? 'active' : ''}}" 
          bindtap="setTargetSize" 
          data-size="auto"
        >自动</button>
        <button 
          class="size-btn {{targetSize === '500kb' ? 'active' : ''}}" 
          bindtap="setTargetSize" 
          data-size="500kb"
        >500KB</button>
        <button 
          class="size-btn {{targetSize === '1mb' ? 'active' : ''}}" 
          bindtap="setTargetSize" 
          data-size="1mb"
        >1MB</button>
        <button 
          class="size-btn {{targetSize === 'custom' ? 'active' : ''}}" 
          bindtap="setTargetSize" 
          data-size="custom"
        >自定义</button>
      </view>
    </view>

    <view class="setting-item" wx:if="{{targetSize === 'custom'}}">
      <text class="setting-label">自定义大小 (KB)</text>
      <input 
        class="size-input" 
        type="number" 
        placeholder="输入目标大小" 
        value="{{customSize}}"
        bindinput="onCustomSizeChange"
      />
    </view>
  </view>

  <!-- 压缩按钮 -->
  <view class="action-section" wx:if="{{imageSrc}}">
    <button class="compress-btn" bindtap="compressImage" disabled="{{compressing}}">
      {{compressing ? '压缩中...' : '开始压缩'}}
    </button>
  </view>

  <!-- 压缩结果 -->
  <view class="result-section" wx:if="{{compressedSrc}}">
    <view class="result-header">
      <text class="result-title">压缩结果</text>
      <text class="success-badge">压缩成功</text>
    </view>
    
    <view class="result-preview">
      <image src="{{compressedSrc}}" mode="aspectFit" class="result-image"></image>
    </view>
    
    <view class="result-info">
      <view class="info-row">
        <text class="info-label">压缩前:</text>
        <text class="info-value">{{originalSize}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">压缩后:</text>
        <text class="info-value">{{compressedSize}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">压缩率:</text>
        <text class="info-value highlight">{{compressionRatio}}%</text>
      </view>
    </view>
    
    <view class="result-actions">
      <button class="save-btn" bindtap="saveImage">保存图片</button>
      <button class="share-btn" bindtap="shareImage">分享图片</button>
    </view>
  </view>
</view>

<!-- 隐藏的canvas用于图片处理 -->
<canvas canvas-id="compressCanvas" style="position: fixed; top: -9999rpx; left: -9999rpx;"></canvas>