<!--grid.wxml-->
<view class="container">
  <!-- 顶部导航 -->
  <view class="header">
    <text class="title">九宫格切图</text>
    <text class="subtitle">一键切图，完美适配朋友圈</text>
  </view>

  <!-- 图片选择区域 -->
  <view class="upload-section">
    <view class="upload-area" bindtap="chooseImage" wx:if="{{!imageSrc}}">
      <view class="upload-icon">⚏</view>
      <text class="upload-text">点击选择图片</text>
      <text class="upload-desc">建议选择正方形图片效果最佳</text>
    </view>
    
    <view class="image-preview" wx:else>
      <image src="{{imageSrc}}" mode="aspectFit" class="preview-image"></image>
      <view class="image-info">
        <text class="info-item">图片尺寸: {{imageDimensions}}</text>
        <text class="info-item">建议比例: 1:1 或 3:4</text>
      </view>
      <button class="change-btn" bindtap="chooseImage">重新选择</button>
    </view>
  </view>

  <!-- 切图设置 -->
  <view class="settings-section" wx:if="{{imageSrc}}">
    <view class="setting-item">
      <text class="setting-label">九宫格切图说明</text>
      <view class="grid-options">
        <button 
          class="grid-btn {{gridMode === '3x3' ? 'active' : ''}}" 
          bindtap="setGridMode" 
          data-mode="3x3"
        >
          <view class="grid-preview">
            <view class="grid-item"></view>
            <view class="grid-item"></view>
            <view class="grid-item"></view>
            <view class="grid-item"></view>
            <view class="grid-item"></view>
            <view class="grid-item"></view>
            <view class="grid-item"></view>
            <view class="grid-item"></view>
            <view class="grid-item"></view>
          </view>
          <text class="grid-name">3×3 九宫格</text>
        </button>
        
        <button 
          class="grid-btn {{gridMode === '2x3' ? 'active' : ''}}" 
          bindtap="setGridMode" 
          data-mode="2x3"
        >
          <view class="grid-preview">
            <view class="grid-item"></view>
            <view class="grid-item"></view>
            <view class="grid-item"></view>
            <view class="grid-item"></view>
            <view class="grid-item"></view>
            <view class="grid-item"></view>
          </view>
          <text class="grid-name">2×3 六宫格</text>
        </button>
        
        <button 
          class="grid-btn {{gridMode === '4x4' ? 'active' : ''}}" 
          bindtap="setGridMode" 
          data-mode="4x4"
        >
          <view class="grid-preview">
            <view class="grid-item small"></view>
            <view class="grid-item small"></view>
            <view class="grid-item small"></view>
            <view class="grid-item small"></view>
            <view class="grid-item small"></view>
            <view class="grid-item small"></view>
            <view class="grid-item small"></view>
            <view class="grid-item small"></view>
            <view class="grid-item small"></view>
            <view class="grid-item small"></view>
            <view class="grid-item small"></view>
            <view class="grid-item small"></view>
            <view class="grid-item small"></view>
            <view class="grid-item small"></view>
            <view class="grid-item small"></view>
            <view class="grid-item small"></view>
          </view>
          <text class="grid-name">4×4 十六宫格</text>
        </button>
      </view>
    </view>


  </view>

  <!-- 切图按钮 -->
  <view class="action-section" wx:if="{{imageSrc}}">
    <button class="cut-btn" bindtap="cutImage" disabled="{{cutting}}">
      {{cutting ? '切图中...' : '开始切图'}}
    </button>
  </view>

  <!-- 切图结果 -->
  <view class="result-section" wx:if="{{gridImages.length > 0}}">
    <view class="result-header">
      <text class="result-title">切图完成</text>
      <text class="success-badge">{{gridImages.length}}张图片</text>
    </view>
    
    <view class="result-grid">
      <view class="result-item" wx:for="{{gridImages}}" wx:key="index" bindtap="previewImage" data-index="{{index}}">
        <image src="{{item}}" mode="aspectFit" class="result-image"></image>
        <text class="item-index">{{index + 1}}</text>
      </view>
    </view>
    
    <view class="result-actions">
      <button class="save-all-btn" bindtap="saveAllImages">保存全部</button>
      <button class="share-btn" bindtap="shareImages">分享图片</button>
    </view>
  </view>
</view>

<!-- 隐藏的canvas -->
<canvas canvas-id="gridCanvas" style="position: fixed; top: -9999rpx; left: -9999rpx; width: 2000px; height: 2000px;"></canvas>