<!--batch.wxml-->
<view class="container">
  <!-- 顶部导航 -->
  <view class="header">
    <text class="title">批量处理</text>
    <text class="subtitle">同时处理多张图片，提升效率</text>
  </view>

  <!-- VIP提示 -->
  <view class="vip-notice" wx:if="{{!isVip}}">
    <view class="notice-icon">💎</view>
    <view class="notice-content">
      <text class="notice-title">VIP专属功能</text>
      <text class="notice-desc">此功能需要VIP会员（9.9元/月）</text>
    </view>
    <button class="vip-btn" bindtap="goToVip">开通VIP</button>
  </view>

  <!-- 图片选择区域 -->
  <view class="upload-section">
    <view class="upload-area" bindtap="chooseImages" wx:if="{{images.length === 0}}">
      <view class="upload-icon">📦</view>
      <text class="upload-text">点击选择多张图片</text>
      <text class="upload-desc">最多可选择9张图片</text>
    </view>
    
    <view class="images-preview" wx:else>
      <view class="images-grid">
        <view class="image-item" wx:for="{{images}}" wx:key="index">
          <image src="{{item}}" mode="aspectFill" class="thumb-image"></image>
          <view class="remove-btn" bindtap="removeImage" data-index="{{index}}">×</view>
        </view>
        <view class="add-more" bindtap="chooseImages" wx:if="{{images.length < 9}}">
          <text class="add-icon">+</text>
        </view>
      </view>
      <button class="change-btn" bindtap="chooseImages">重新选择</button>
    </view>
  </view>

  <!-- 批量设置 -->
  <view class="settings-section" wx:if="{{images.length > 0}}">
    <view class="setting-item">
      <text class="setting-label">处理类型</text>
      <view class="batch-options">
        <button 
          class="batch-btn {{batchType === 'compress' ? 'active' : ''}}" 
          bindtap="setBatchType" 
          data-type="compress"
        >批量压缩</button>
        <button 
          class="batch-btn {{batchType === 'convert' ? 'active' : ''}}" 
          bindtap="setBatchType" 
          data-type="convert"
        >格式转换</button>
        <button 
          class="batch-btn {{batchType === 'resize' ? 'active' : ''}}" 
          bindtap="setBatchType" 
          data-type="resize"
        >尺寸调整</button>
      </view>
    </view>
  </view>

  <!-- 处理按钮 -->
  <view class="action-section" wx:if="{{images.length > 0}}">
    <button class="process-btn" bindtap="processBatch" disabled="{{processing}}">
      {{processing ? '处理中...' : '开始处理' + images.length + '张图片'}}
    </button>
  </view>

  <!-- 处理结果 -->
  <view class="result-section" wx:if="{{processedImages.length > 0}}">
    <view class="result-header">
      <text class="result-title">处理完成</text>
      <text class="success-badge">{{processedImages.length}}张成功</text>
    </view>
    
    <view class="result-grid">
      <view class="result-item" wx:for="{{processedImages}}" wx:key="index" bindtap="previewImage" data-index="{{index}}">
        <image src="{{item}}" mode="aspectFill" class="result-image"></image>
      </view>
    </view>
    
    <view class="result-actions">
      <button class="save-all-btn" bindtap="saveAllImages">保存全部</button>
    </view>
  </view>
</view>