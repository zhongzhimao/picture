<!--crop.wxml-->
<view class="container">
  <!-- 顶部导航 -->
  <view class="header">
    <text class="title">裁剪旋转</text>
    <text class="subtitle">基础图片编辑功能</text>
  </view>

  <!-- 图片选择区域 -->
  <view class="upload-section">
    <view class="upload-area" bindtap="chooseImage" wx:if="{{!imageSrc}}">
      <view class="upload-icon">✂️</view>
      <text class="upload-text">点击选择图片</text>
      <text class="upload-desc">支持裁剪、旋转等基础编辑</text>
    </view>
    
    <view class="image-preview" wx:else>
      <view class="image-container">
        <image 
          src="{{imageSrc}}" 
          mode="aspectFit" 
          class="preview-image"
          style="transform: rotate({{rotation}}deg) scale({{scale}})"
        ></image>
      </view>
      <view class="image-info">
        <text class="info-item">图片尺寸: {{imageDimensions}}</text>
        <text class="info-item">旋转角度: {{rotation}}°</text>
      </view>
      <button class="change-btn" bindtap="chooseImage">重新选择</button>
    </view>
  </view>

  <!-- 编辑工具 -->
  <view class="tools-section" wx:if="{{imageSrc}}">
    <view class="tool-group">
      <text class="tool-title">旋转</text>
      <view class="tool-buttons">
        <button class="tool-btn" bindtap="rotateImage" data-angle="-90">
          <text class="tool-icon">↺</text>
          <text class="tool-label">左转90°</text>
        </button>
        <button class="tool-btn" bindtap="rotateImage" data-angle="90">
          <text class="tool-icon">↻</text>
          <text class="tool-label">右转90°</text>
        </button>
        <button class="tool-btn" bindtap="rotateImage" data-angle="180">
          <text class="tool-icon">⇄</text>
          <text class="tool-label">翻转180°</text>
        </button>
      </view>
    </view>

    <view class="tool-group">
      <text class="tool-title">翻转</text>
      <view class="tool-buttons">
        <button class="tool-btn" bindtap="flipImage" data-direction="horizontal">
          <text class="tool-icon">↔️</text>
          <text class="tool-label">水平翻转</text>
        </button>
        <button class="tool-btn" bindtap="flipImage" data-direction="vertical">
          <text class="tool-icon">↕️</text>
          <text class="tool-label">垂直翻转</text>
        </button>
      </view>
    </view>

    <view class="tool-group">
      <text class="tool-title">缩放</text>
      <slider 
        class="scale-slider" 
        min="50" 
        max="200" 
        value="{{scaleValue}}" 
        bindchange="onScaleChange"
        activeColor="#667eea"
        backgroundColor="#e0e0e0"
        block-size="20"
      />
      <text class="scale-value">{{scaleValue}}%</text>
    </view>

    <view class="tool-group">
      <text class="tool-title">快速裁剪</text>
      <view class="crop-ratios">
        <button 
          class="ratio-btn {{cropRatio === '1:1' ? 'active' : ''}}" 
          bindtap="setCropRatio" 
          data-ratio="1:1"
        >1:1</button>
        <button 
          class="ratio-btn {{cropRatio === '4:3' ? 'active' : ''}}" 
          bindtap="setCropRatio" 
          data-ratio="4:3"
        >4:3</button>
        <button 
          class="ratio-btn {{cropRatio === '16:9' ? 'active' : ''}}" 
          bindtap="setCropRatio" 
          data-ratio="16:9"
        >16:9</button>
        <button 
          class="ratio-btn {{cropRatio === 'free' ? 'active' : ''}}" 
          bindtap="setCropRatio" 
          data-ratio="free"
        >自由</button>
      </view>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-section" wx:if="{{imageSrc}}">
    <button class="reset-btn" bindtap="resetImage">重置</button>
    <button class="apply-btn" bindtap="applyEdit">应用编辑</button>
  </view>

  <!-- 编辑结果 -->
  <view class="result-section" wx:if="{{editedSrc}}">
    <view class="result-header">
      <text class="result-title">编辑完成</text>
      <text class="success-badge">编辑成功</text>
    </view>
    
    <view class="result-preview">
      <image src="{{editedSrc}}" mode="aspectFit" class="result-image"></image>
    </view>
    
    <view class="result-actions">
      <button class="save-btn" bindtap="saveImage">保存图片</button>
      <button class="share-btn" bindtap="shareImage">分享图片</button>
    </view>
  </view>
</view>

<!-- 隐藏的canvas -->
<canvas canvas-id="cropCanvas" style="position: fixed; top: -9999rpx; left: -9999rpx;"></canvas>