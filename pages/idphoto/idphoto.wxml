<!--idphoto.wxml-->
<view class="container">
  <!-- 顶部导航 -->
  <view class="header">
    <text class="title">证件照换底</text>
    <text class="subtitle">一键更换证件照背景色</text>
  </view>

  <!-- VIP提示 -->
  <view class="vip-notice" wx:if="{{!isVip}}">
    <view class="notice-icon">💎</view>
    <view class="notice-content">
      <text class="notice-title">VIP专属功能</text>
      <text class="notice-desc">此功能需要VIP会员或2积分/次</text>
    </view>
    <button class="vip-btn" bindtap="goToVip">开通VIP</button>
  </view>

  <!-- 图片选择区域 -->
  <view class="upload-section">
    <view class="upload-area" bindtap="chooseImage" wx:if="{{!imageSrc}}">
      <view class="upload-icon">👤</view>
      <text class="upload-text">点击选择证件照</text>
      <text class="upload-desc">建议选择正面证件照</text>
    </view>
    
    <view class="image-preview" wx:else>
      <image src="{{imageSrc}}" mode="aspectFit" class="preview-image"></image>
      <button class="change-btn" bindtap="chooseImage">重新选择</button>
    </view>
  </view>

  <!-- 背景色选择 -->
  <view class="color-section" wx:if="{{imageSrc}}">
    <view class="section-title">选择背景色</view>
    <view class="color-options">
      <button 
        class="color-btn {{bgColor === 'white' ? 'active' : ''}}" 
        bindtap="setBgColor" 
        data-color="white"
        style="background: #ffffff; border: 2rpx solid #e0e0e0;"
      >
        <text class="color-name">白色</text>
      </button>
      <button 
        class="color-btn {{bgColor === 'blue' ? 'active' : ''}}" 
        bindtap="setBgColor" 
        data-color="blue"
        style="background: #438EDB;"
      >
        <text class="color-name">蓝色</text>
      </button>
      <button 
        class="color-btn {{bgColor === 'red' ? 'active' : ''}}" 
        bindtap="setBgColor" 
        data-color="red"
        style="background: #FF0000;"
      >
        <text class="color-name">红色</text>
      </button>
      <button 
        class="color-btn {{bgColor === 'gray' ? 'active' : ''}}" 
        bindtap="setBgColor" 
        data-color="gray"
        style="background: #808080;"
      >
        <text class="color-name">灰色</text>
      </button>
    </view>
  </view>

  <!-- 费用提示 -->
  <view class="cost-section" wx:if="{{imageSrc && !isVip}}">
    <view class="cost-info">
      <text class="cost-label">本次消费:</text>
      <text class="cost-value">2积分</text>
    </view>
    <text class="cost-desc">当前余额: {{userData.credits}}积分</text>
  </view>

  <!-- 处理按钮 -->
  <view class="action-section" wx:if="{{imageSrc}}">
    <button class="process-btn" bindtap="processIdPhoto" disabled="{{processing}}">
      {{processing ? '处理中...' : '开始换底色'}}
    </button>
  </view>

  <!-- 处理结果 -->
  <view class="result-section" wx:if="{{processedSrc}}">
    <view class="result-header">
      <text class="result-title">换底完成</text>
      <text class="success-badge">处理成功</text>
    </view>
    
    <view class="result-comparison">
      <view class="comparison-item">
        <text class="comparison-label">原图</text>
        <image src="{{imageSrc}}" mode="aspectFit" class="comparison-image"></image>
      </view>
      <view class="comparison-arrow">→</view>
      <view class="comparison-item">
        <text class="comparison-label">换底后</text>
        <image src="{{processedSrc}}" mode="aspectFit" class="comparison-image"></image>
      </view>
    </view>
    
    <view class="result-actions">
      <button class="save-btn" bindtap="saveImage">保存图片</button>
      <button class="share-btn" bindtap="shareImage">分享图片</button>
    </view>
  </view>
</view>